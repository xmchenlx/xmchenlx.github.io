---
title: 数据指标Vue项目代码交接说明
abbrlink: 51bc
toc: true
date: 2021-06-01 17:39:13
tags:
---
# 使用到的技术

本项目使用的技术是Vue-cli项目框架、Axios数据请求、Element UI框架、xlsx表格读取插件、echarts图标插件、moment时间格式化插件、drag-tree-table树形表格插件、d3高度自由图表插件、数字逐增动画插件等。



# 项目目录说明

## 简要说明

本项目的文件放置规范是不太符合目前行业里的文件存放共识的。

本项目的所有代码都存放于`src/sjzb/`里。

路由文件存放在`src/router`里。

静态文件（如字体、css全局样式）存放于`src/assets`里。

图片资源存放于`src/img`里。

api交互文件存放于`src/api`里。

项目的布局参考Axure原型图。链接为[https://vgtdts.axshare.com/#id=yyrxdh&p=%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B_%E9%A6%96%E9%A1%B5_&g=1](https://vgtdts.axshare.com/#id=yyrxdh&p=%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B_%E9%A6%96%E9%A1%B5_&g=1)

在2021年的10月1日前，可以通过临时域名[bishe.chenlx.top](http://bishe.chenlx.top)进行项目的预览。在这个时间过后，这个域名将会因为过期而撤销。

## 目录概要

### 整体说明

本项目的目录划分目前是按照Axure原型图的规划将文件存放于各个文件夹。也就是说，按照业务逻辑进行分类。但一开始并没有遵循该原则，所以有一部分的文件会存放在其他的地方。对于找不到的文件可以尝试通过路由文件的形式进行搜索，或者树形菜单文件进行查找，下方会进行说明。

### 项目的访问入口&页面跳转的方法说明

项目的入口在App.vue里。当项目开始运行后，通过`App.vue`进入Vue 项目，再通过`index.vue`进入项目的整体框架（导航栏、主栏、侧栏）。

- 导航栏即包含Logo的顶栏。
- 侧栏是侧边导航栏，目前包含4个按钮，倒数三个按钮目前没有规划。
- 主栏即主要内容，包含接下来要使用的树形菜单、页面详情。

> 所有的页面都通过`<router-view>`将每一个`.vue组件`中的内容进行切换显示。`router-view`标签类似`iframe`标签。能达到当前页面里只有某一个 区域的内容进行变化和渲染。

从`index.vue`里将进入`dbView.vue`。这里算是真正的数据指标项目的总框架页面。这个组件包含树形菜单以及页面内容。

- 树形菜单即页面左侧的树状菜单，包括菜单本身以及搜索框。单击菜单项可以进行页面跳转。
- 页面内容来自于接下来要说明的各个业务里的组件，通过`src/router/index.js`进行标明，并在`src/sjzb/components/treenav.vue`里提供跳转的功能。

> Vue项目里，src目录是整个项目的页面资源目录，在代码里，可以通过`@`符号来代表`/src`目录。

所有文件夹的首目录一般都叫`index.vue`，或者`xxxTable.vue`。在早期时，文件都以业务+Table来标明这是xx业务的首页（如：物理模型的首页，就叫作`modelTable.vue`，但现在都已用`index.vue`进行表示。

### 命名方法

文件夹的命名方法通常采用Axure提供的目录进行英文直译。如`数据模型`就会翻译成`dataModel`，`概念模型`就会翻译成`concept`。出现代码本身内容与文件名不一致的情况，可能是因为该文件在中途发生了逻辑上的变更。

### 文件更名注意事项

基本上来说，每一个文件的文件名不能随意更改，否则其他文件的引用就会出现问题。如果更改了文件名，请统一整个项目的文件名，并批量替换。

## Bus.js文件

Bus文件是Vue项目里组件之间通信的桥梁。通过bus.$emit和bus.$on可以再不同的页面之间传递参数，在数据指标项目里最明显的效果，就是在物理模型的表格里，想查看C模型的详情信息时，跳转页面同时带上`C模型`这个参数。

## main.js

main文件是项目的配置文件，主要是对插件的全局引用和一些参数的配置。

## publicFunc/index.js

这个文件的用途是用来存放一些公共的函数，如：处理数字格式、获取固定的数据集合等等。

## router/index.js

这个文件存放着项目的路由信息。不论是直接输入url，或者是通过树形菜单点击菜单项，跳转的依据都从该路由文件查找获取。简单说明一下几个参数。

```javascript
 {
 path: url上显示的路径
 component: 加载的组件名称，通过es6的箭头函数导入
 name: 路由的别称，path过长时，如果name的明明规范，可以很有效的替代path的效果。
 meta:附带信息，如标题
 hidden: 是否隐藏，只能输入布尔值
 children: 是否有孩子，该变量存放对象数组，也就是[{},{}]
 },
```

## 关于每个业务的详细解释

### 数据模型首页（Default.vue）

# 关于树形菜单的说明

## 搜索

## 菜单本身

### 	如何增添改用

菜单的组件在`src/sjzb/components/treenav.vue`里。里头存储着菜单信息的对象数组。根据需要进行增删改。

### 	关于图标

#### 			图标的自动填充

js程序里，对图标的某些条件下会进行自动填充。当前对象没有孩子，且没有指定图标时，会填充`{}`样式的图标。

#### 			图标的更换

图标来源来自Element UI 以及iconfont网站。如果直接使用eleUI的图标，直接在变量值里填入网站内提供的iconNam计科（如，'+'号，就直接填入`el-icon-plus`）。如果使用iconfont字体图标，请多补充两个样式名称来进行调整（如添加数据库图标，则样式名要填入`iconfont treeIcon icon-shujuku2`）。`treeIcon`为后来临时协调的样式，如果在iconfont网站上寻找的图片比之前的还要偏大或者偏小，这个`treeIcon`可能协调的效果并不完美，就需要新写一个样式来与整体的图标的大小保持相同了。

# 关于页面布局的说明

## 整体

### 面包屑

### 上方的总体区域

#### 搜索框&热词

搜索框一般存在于业务的首页里，如基本词类次、数值指标0-数据模型的首页。

#### 统计卡片

统计卡片放置在页面上方，以4种颜色循环显示。目前通过变量写死的方式进行展示。

#### 表单

表单的样式经过较为深度的更改，与三种class进行搭配组合出表单的效果。其中，`small_input`大约占用宽度的1/3；`medium_input`大约占用宽度的1/2；`full_input`占用一整行的宽度，更多的样式效果请参考上述说明的全局css文件中对于Input控件的表述。

#### 复杂表单

复杂表单就是在常规表单的基础上，与收缩栏进行结合现实的效果，其输入的表单项都归纳到了同一个变量属性里。一般这个变量叫作`ikForm`。如果有更多其他的表单项，在新建的同时，请把新表单项的属性放入`ikForm`，否则会因为Vue的数据双向绑定的原因，而无法输入。

#### 标签

#### 【更多|···】操作按钮

位于页面上方的更多按钮，都用`id="moremenu"`来标识。借助eleUI的下拉菜单控件来达到呼出菜单的效果。

```html
<div id="moremenu">
            <el-dropdown>
                <el-button type="text" style="font-size: 1rem" icon="el-icon-more"></el-button>
                <el-dropdown-menu slot="dropdown">
                    <el-dropdown-item v-for="(obj, index) in getBoxRightClickMenuList(cardData.moreMenu)" :key="index" :divided="obj.divided" @click.native="obj.onClick()">
                        <i :class="obj.icon" :style="obj.iconStyle" />
                        {{ obj.label }}
                    </el-dropdown-item>
                </el-dropdown-menu>
            </el-dropdown>
        </div>
```



### 下方的数据区域

#### 标签页

略。具体看代码注释。

#### 常规表格

略。具体看代码注释。

#### 复杂表单

复杂表单的运用情况主要是有收缩栏的布局情况下需要使用。其本质上就是在常规表格的外面再包一层收缩栏。

#### 图形SVG

目前这个部分的代码是直接引用生成的svg代码放入.vue组件中（也就是写死的）。项目里唯一有svg的代码，在`概念模型-模型详情`里的引导图组件中体现。

#### 可拖拽的树形表格

可拖拽的树形表格来源于https://www.cnblogs.com/bfgis/p/9805928.html   。其表格可以支持拖拽到其他的结点或者子节点里。但是操作栏只能支持<a>标签，无法支持eleUi的呼出菜单。

#### 另一款树形表格（二改）

这一款树形表格控件来源于https://github.com/sijinglei/vue-tree-table

这个控件的显示效果比上一款树形表格的显示效果好一些，但是不支持拖拽。且原来的表格树状表格的表头是写死的；为此进行了修改，可以支持`props`填入表头属性，`propsCh`填入表头标题达到组件化表格的目的。

#### 常规表格里的【更多|···】操作按钮

更多按钮目前统一是用Element Ui的下拉菜单控件，每一个菜单项都依靠当前组件的函数进行组合，一般这个函数叫作`getRightClickMenu()`或者类似的函数名称。

#### 表格里的右键事件

表格中的右击事件采用的是该作者提供的插件进行实现。链接：https://segmentfault.com/a/1190000021430700。该页面已有使用步骤，这里不再另外说明。

#### 原生表格

原生表格主要是应对横向表格的需求而使用的。目前使用`databaseType`样式来统一表示该应用场景的效果。



## 常规布局编写

## JSON布局自动生成

### 意义解释

在频繁迭代的Axure图里，总会出现非常相似的页面布局。所以这部分相似的页面布局，为了不重复写这些布局代码，就用JSON配置的方式，让页面在渲染时，通过v-for的方法生成页面的每一个控件。一般来说，用JSON生成页面的组件，开头都会有一段注释来进行说明。**但这个自动生成的页面再后续开发是不适用的，目前只适用于为了产生DEMO快速开发的情况。**

```js
<!---------------------------------------------------------------------
|
|    本页面为JSON生成控件页面，在CardData和TabData输入相应属性和值
|
<!--------------------------------------------------------------------->
```

在组件中可能出现某一个div或者其他的标签里，标注着`v-if="1==2"`，这是为了将这个标签不显示在页面上而进行的标注，`v-if`属性接收布尔值，从而决定该标签是否渲染到DOM上。而正常来讲，不需要用到的标签为了不让代码混乱，是需要删除的；但是在下一个迭代版本，这个标签里的内容可能又需要显示回来，充满不确定性，故先临时隐藏，等同于`style="display:none"`。

### cardData——上方·表单信息

这个变量用于渲染上方表格的内容。

```js
 isUse: 决定该选项是否使用并显示，接收布尔值,
                moreMenu: //右上···菜单的内容，接收参数为对象数组,
                formProp: [{
                        label: //表单项的标签名,
                        prop: //表单属性名称,
                        ele: //表单控件类型：text、textarea、null,
                        class: //控件长度：'small_input'、medium_input、large_input、full_input,
                        isBr: //布尔值，暂时无用
                    },

                ],
                formData: {
                   //这里的data内容用来填充表单每一个项的值。需要与上方表单的prop一致。
                },
                tags: {
                    //这里是放置标签的，样式已经固定。
                    isUse:false,
                    data:{
                    dept: ['部门标签a'], //部门标签
                    classic: ['分类标签A', 'mysql'], //分类标签
                    styles: ['0512存'] //个性标签
                }
                }
```

### tabsData——下方·标签页信息

这个变量用于显示页面下方的标签页的内容信息。如果有多个选项卡，请组成对象数组。

```js
 {
                    tabname: "操作日志", //标签页的页头（名字）
                    type: 'table',//标签页里显示的内容：table、mutitable、mutiforms
                    propsLabel: ["时间戳",  "动作","操作人"],//表格的表头中文标签
                    props: ["time", "action", "name"], //表格的属性
                    clickMenuList: ["edit", "delete"],//表格的更多操作按钮中的菜单项（日志类表格是没有的）
                    tableOption: {
                        //表格下方的配置项，皆为布尔值
                        isPager: true,//分页，当不足1页时分页会自动隐藏，请直接按需开启
                        isFilter: true,//过滤
                        isCreate: false,//新建
                    },
                    data: [
                        {},{}
                        //这里放表格的内容，请放置对象数组，一个对象对应一行，key请严格按照表格的prop进行放置。
                    ],
                },
```

### stasticList ——上方·统计卡片区域

与上述类似，不再说明。

```js
 
{
    			isUse: true,
                data: [
                    {
                        name: "新增表", //显示的内容标题
                        count: "5",//统计数值
                    },
                    {
                        name: "修改表",
                        count: "32",
                    },
                    {
                        name: "删除表",
                        count: "3",
                    },
                    {
                        name: "错误",
                        count: "3",
                    },
                    {
                        name: "警告",
                        count: "37",
                    },
                ],
}
```



# 关于首页文字导入替换功能

资产链的首页支持将各个区域的文字进行替换。功能的入口藏在了首页右上方的【···】按钮，单击自动化按钮进入替换操作的页面。借助Excel模板，可以将文字导入进系统进行替换。由于替换文字信息是借助`sessionStorage`进行存储的，所以替换的生效时段为`替换成功后~浏览器关闭页面前`。重新打开页面时，替换文字将还原为默认文字。导入的Excel文件需为一开始提供的模板。擅自更改模板填写的区域或其他变更会导致替换失败。

替换的组件路径是`src/homepage/importExcel.vue`

# 关于样式

## 全局样式

数据指标项目的全局样式基于ElementUI进行了较为深度的更改，为了避免冗余的代码，在`src/assets/zbcss.css`这个文件里，放入了对于空间样式更改的css内容。这个css文件的代码在全局都是生效的。如果没有特殊的需求，就尽量不要再去变动已存在的css代码。

## 当前页的样式

当前页的样式都各自存在每一个`.vue`文件最下方的`<style scoped>`里。在`scoped`标识符标注的style标签，使得这个样式只在本.vue文件里生效。这个优先级会高于上述说的全局样式，有特殊的样式效果请在这里编写。



# 关于与后台进行数据交互

在以往的版本，仍然有使用Vue+SpringBoot+Neo4j的形式进行数据交换，使用的是axios插件。但前端页面的版本反复迭代，并且目前没有显示真实数据库里的数据的需求，**所以在后面的版本中，这个交互的代码被注释或者删除。**后续有需求进行数据交互时，请在`main.js`中指定axios的请求url，并在`/src/api`目录新增js文件并编写交互请求的函数。

# 运行使用

项目的运行依赖npm工具、node.js；使用vue-cli工具编写及维护项目；项目中使用到了axios、ElementUI、momentjs等的插件。在新环境运行前，需要先安装node软件（最新版本即可）、npm包管理工具（7.14.0）。

安装完后，请全局下载vue-cli脚手架工具。在cmd输入`npm install vue-cli -g`即可安装。

接着，需要下载项目插件依赖，这些依赖的包名都被统一到了`package.json`管理，安装完的插件包则会被放置到`node_modules`文件夹。项目包已内含`node_modules`，但如果运行失败，且原因可能是包丢失或版本不一致的话，可以再尝试`npm install`命令进行包安装。

如电脑环境已有上述安装，可忽略；如果运行碰到了其他的问题，可以尝试上网搜索一下，一般对于安装运行过程中的问题网上都会有解答。

解压项目到指定位置，根据不同环境的需求进行运行。

## 开发环境运行

在开发环境，输入`npm run dev`进行启动。设定的访问地址为`http://localhost:8080`。根据实际端口占用的情况可能会变更（例如我这台电脑实际运行的端口是8081）。

## 打包文件

打包出来的文件即可用Nginx等软件进行部署访问。首先输入`npm run build`命令，对项目进行打包。生成的文件夹叫作`dist`。访问index.html即可通过入口进入项目。但是！直接打开文件是无法访问的，一定要通过部署nginx、apache等软件才能使用。